---
import Layout from '../layouts/Layout.astro';
import StarryBackground from '../components/StarryBackground.astro';
import HudHeader from '../components/HudHeader.astro';
import ContactInfoBar from '../components/ContactInfoBar.astro';
import BackgroundHUD from '../components/BackgroundHUD.astro';
import Form from '../components/Form.astro';
import CadreContactSvg from '../assets/svg/cadre_contact.svg?raw';
import EarthWhiteSvg from '../assets/svg/earthwhite.svg?raw';
---

<Layout title="Contact - Andrea Mestre">
	<StarryBackground />
	<HudHeader currentPage="contact" />
	<BackgroundHUD />
	
	<main class="min-h-screen pt-32 pb-16 px-8 relative z-10 flex justify-center items-center">

		<div class="w-full max-w-6xl relative p-8">
			<h1 class="text-white text-center tracking-wide mb-8 drop-shadow-[0_0_10px_rgba(255,255,255,0.5)]" style="font-family: var(--font-title1); font-size: var(--size-title1);">CONTACT</h1>
			<ContactInfoBar />
			
			<div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mt-8">
				<!-- Section gauche - Formulaire -->
				<div class="lg:col-span-2 flex flex-col">
					<Form />
				</div>
				
				<!-- Section droite - Éléments HUD -->
				<div class="flex flex-col gap-8">
					<!-- Globe avec cadre -->
					<div class="relative">
						<!-- Cadre de contact -->
						<div class="w-full max-w-[343px] mx-auto" set:html={CadreContactSvg}></div>
						
						<!-- Globe terrestre à l'intérieur du cadre -->
						<div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 -mt-5">
							<div class="relative w-56 h-56 flex items-center justify-center">
								<canvas id="contact-globe" class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-56 h-56"></canvas>
							</div>
						</div>
						
						<!-- Coordonnées géographiques en bas du cadre -->
						<div class="absolute bottom-[18px] left-1/2 transform -translate-x-1/2">
							<div class="text-sm tracking-wide text-center whitespace-nowrap coordinates-glow" style="font-family: var(--font-smalltext); color: var(--color-pink);">
								46° 22' 30.212" N 72° 33' 28.962" W
							</div>
						</div>
					</div>
					
					<!-- Barres d'égalisation audio -->
					<div class="flex justify-center items-end gap-1 h-20">
						<div class="bg-[#962EB9] w-3 h-8 opacity-70 animate-pulse" style="animation-delay: 0s;"></div>
						<div class="bg-[#962EB9] w-3 h-12 opacity-70 animate-pulse" style="animation-delay: 0.1s;"></div>
						<div class="bg-[#962EB9] w-3 h-6 opacity-70 animate-pulse" style="animation-delay: 0.2s;"></div>
						<div class="bg-[#962EB9] w-3 h-16 opacity-70 animate-pulse" style="animation-delay: 0.3s;"></div>
						<div class="bg-[#962EB9] w-3 h-10 opacity-70 animate-pulse" style="animation-delay: 0.4s;"></div>
						<div class="bg-[#962EB9] w-3 h-20 opacity-70 animate-pulse" style="animation-delay: 0.5s;"></div>
						<div class="bg-[#962EB9] w-3 h-14 opacity-70 animate-pulse" style="animation-delay: 0.6s;"></div>
						<div class="bg-[#962EB9] w-3 h-8 opacity-70 animate-pulse" style="animation-delay: 0.7s;"></div>
						<div class="bg-[#962EB9] w-3 h-18 opacity-70 animate-pulse" style="animation-delay: 0.8s;"></div>
					</div>
				</div>
			</div>
		</div>
	</main>
</Layout>

<style>
	/* SVG du cadre responsive */
	.cadre-container svg {
		width: 100%;
		height: auto;
	}

	/* Canvas globe - taille fixe nécessaire pour l'animation */
	#contact-globe {
		width: 224px !important;
		height: 224px !important;
	}

	/* Effet de scintillement néon pour les coordonnées - animation complexe */
	.coordinates-glow {
		text-shadow: 
			0 0 5px var(--color-pink),
			0 0 10px var(--color-pink),
			0 0 15px var(--color-pink),
			0 0 20px var(--color-pink);
		animation: neonFlicker 2s ease-in-out infinite alternate;
	}

	@keyframes neonFlicker {
		0%, 18%, 22%, 25%, 53%, 57%, 100% {
			text-shadow: 
				0 0 5px var(--color-pink),
				0 0 10px var(--color-pink),
				0 0 15px var(--color-pink),
				0 0 20px var(--color-pink),
				0 0 35px var(--color-pink),
				0 0 40px var(--color-pink);
		}
		20%, 24%, 55% {
			text-shadow: 
				0 0 2px var(--color-pink),
				0 0 5px var(--color-pink),
				0 0 8px var(--color-pink),
				0 0 12px var(--color-pink);
		}
	}
</style>

<script>
	const c = document.getElementById('contact-globe') as HTMLCanvasElement;
	if (!c) throw new Error('Canvas not found');
	const s = c.width = c.height = 224;
	const ctx = c.getContext('2d')!;;;;
	
	const opts = {
		globeRadius: 84,
		depth: 168,
		focalLength: 168,
		center: s / 2,
		
		rotYVel: .01,
		baseXRot: -0.41,
		afterYRot: -2,
	};
	
	const rot = {
		y: {
			cos: Math.cos(opts.rotYVel),
			sin: Math.sin(opts.rotYVel)
		},
		z: {
			cos: Math.cos(opts.baseXRot),
			sin: Math.sin(opts.baseXRot)
		},
		ay: {
			cos: Math.cos(opts.afterYRot),
			sin: Math.sin(opts.afterYRot)
		}
	};

	function anim() {
		window.requestAnimationFrame(anim);
		
		ctx.fillStyle = 'transparent';
		ctx.clearRect(0, 0, s, s);
		
		ctx.strokeStyle = '#962EB9';
		
		ctx.beginPath();
		
		for (let i = 0; i < lines.length; ++i) {
			const points = lines[i];
			
			for (let j = 0; j < points.length; ++j) {
				const point = points[j];
				let x = point.x;
				let y = point.y;
				let z = point.z;
				
				const X = x;
				x = x * rot.y.cos - z * rot.y.sin;
				z = z * rot.y.cos + X * rot.y.sin;
				
				point.x = x;
				point.z = z;
				
				const Y = y;
				y = y * rot.z.cos - x * rot.z.sin;
				x = x * rot.z.cos + Y * rot.z.sin;
				
				const X2 = x;
				x = x * rot.ay.cos - z * rot.ay.sin;
				z = z * rot.ay.cos + X2 * rot.ay.sin;
				
				z += opts.depth;
				
				const scale = opts.focalLength / z;
				const sx = opts.center + scale * x;
				const sy = opts.center + scale * y;
				
				point.sx = sx;
				point.sy = sy;
				
				ctx[j === 0 ? 'moveTo' : 'lineTo'](sx, sy);
			}
						
			ctx.lineTo(points[0].sx, points[0].sy);
		}
		
		ctx.stroke();
	}

	// Données des continents
	const linesData = [
		// africa main continent
		[-.04, -.05, .01, -.05, .02, -.07, .06, -.03, .05, .03, .08, .12, .06, .18, .08, .25, .10, .35, .10, .39, .15, .37, .18, .33, .17, .28, .19, .28, .19, .23, .22, .19, .22, .06, .27, -.033, .29, -.15, .23, -.13, .175, -.33, .12, -.36, .1, -.32, .06, -.36, .06, -.405, .01, -.39, -.03, -.38, -.05, -.35, -.08, -.28, -.08, -.205, -.088, -.15],
		// madagascar
		[0.245, 0.192, 0.245, 0.233, 0.241, 0.267, 0.249, 0.3, 0.266, 0.275, 0.287, 0.175, 0.274, 0.142],
		// antarctica
		[-0.984, 0.892, -0.918, 0.875, -0.748, 0.825, -0.662, 0.817, -0.559, 0.842, -0.559, 0.792, -0.46, 0.825, -0.402, 0.825, -0.414, 0.775, -0.311, 0.692, -0.328, 0.75, -0.324, 0.808, -0.34, 0.825, -0.233, 0.883, -0.023, 0.783, 0.196, 0.783, 0.237, 0.75, 0.254, 0.758, 0.287, 0.725, 0.414, 0.767, 0.464, 0.733, 0.48, 0.733, 0.489, 0.783, 0.505, 0.717, 0.551, 0.725, 0.6, 0.742, 0.625, 0.717, 0.645, 0.758, 0.72, 0.758, 0.79, 0.742, 0.934, 0.783, 0.909, 0.833, 0.922, 0.867],
		// south america
		[-0.427, -0.067, -0.39, -0.142, -0.373, -0.108, -0.373, -0.083, -0.332, -0.125, -0.291, -0.067, -0.282, -0.008, -0.188, 0.075, -0.192, 0.108, -0.212, 0.133, -0.208, 0.217, -0.229, 0.258, -0.254, 0.258, -0.262, 0.283, -0.262, 0.333, -0.287, 0.383, -0.303, 0.383, -0.303, 0.425, -0.336, 0.433, -0.348, 0.458, -0.344, 0.475, -0.369, 0.5, -0.361, 0.525, -0.373, 0.55, -0.357, 0.6, -0.394, 0.6, -0.402, 0.542, -0.394, 0.492, -0.41, 0.433, -0.394, 0.392, -0.406, 0.35, -0.39, 0.308, -0.39, 0.25, -0.381, 0.225, -0.419, 0.15, -0.419, 0.1, -0.456, 0.058, -0.435, 0.025, -0.435, -0.008, -0.427, -0.008, -0.427, -0.058],
		// south american island
		[-0.336, 0.575, -0.307, 0.575, -0.311, 0.6, -0.328, 0.6],
		// north america
		[-0.435, -0.067, -0.456, -0.075, -0.493, -0.15, -0.505, -0.15, -0.526, -0.192, -0.571, -0.192, -0.629, -0.358, -0.604, -0.258, -0.641, -0.308, -0.641, -0.333, -0.687, -0.45, -0.674, -0.533, -0.707, -0.6, -0.72, -0.575, -0.736, -0.617, -0.814, -0.692, -0.847, -0.625, -0.889, -0.608, -0.893, -0.658, -0.905, -0.675, -0.905, -0.717, -0.88, -0.733, -0.909, -0.742, -0.946, -0.742, -0.975, -0.775, -0.955, -0.792, -0.926, -0.758, -0.893, -0.792, -0.703, -0.792, -0.654, -0.808, -0.621, -0.75, -0.522, -0.758, -0.497, -0.792, -0.456, -0.775, -0.39, -0.725, -0.472, -0.75, -0.431, -0.708, -0.476, -0.708, -0.513, -0.667, -0.456, -0.625, -0.435, -0.55, -0.435, -0.617, -0.414, -0.617, -0.435, -0.7, -0.406, -0.7, -0.377, -0.642, -0.353, -0.675, -0.307, -0.592, -0.307, -0.558, -0.373, -0.567, -0.291, -0.55, -0.282, -0.525, -0.344, -0.492, -0.353, -0.517, -0.402, -0.45, -0.419, -0.392, -0.435, -0.35, -0.427, -0.275, -0.447, -0.283, -0.472, -0.333, -0.48, -0.325, -0.526, -0.325, -0.53, -0.233, -0.493, -0.2, -0.485, -0.225, -0.468, -0.225, -0.48, -0.2, -0.468, -0.167, -0.452, -0.167, -0.452, -0.108],
		// cuba
		[-0.464, -0.242, -0.443, -0.25, -0.41, -0.233, -0.414, -0.2, -0.435, -0.242],
		// greenland
		[-0.373, -0.883, -0.365, -0.833, -0.32, -0.85, -0.282, -0.783, -0.295, -0.758, -0.262, -0.667, -0.229, -0.667, -0.229, -0.708, -0.208, -0.742, -0.163, -0.767, -0.113, -0.8, -0.105, -0.825, -0.093, -0.883, -0.064, -0.917, -0.13, -0.917, -0.204, -0.942, -0.282, -0.917, -0.353, -0.917],
		// iceland
		[-0.134, -0.742, -0.093, -0.733, -0.08, -0.7, -0.089, -0.683, -0.118, -0.683, -0.13, -0.708],
		// eurasia
		[-0.006, -0.492, -0.043, -0.475, -0.047, -0.408, -0.035, -0.408, -0.023, -0.4, -0.006, -0.425, 0.014, -0.458, 0.014, -0.475, 0.052, -0.483, 0.072, -0.458, 0.093, -0.442, 0.093, -0.417, 0.101, -0.425, 0.105, -0.425, 0.085, -0.467, 0.072, -0.492, 0.072, -0.5, 0.08, -0.5, 0.113, -0.458, 0.113, -0.442, 0.126, -0.4, 0.134, -0.433, 0.134, -0.45, 0.155, -0.45, 0.159, -0.4, 0.171, -0.4, 0.184, -0.417, 0.188, -0.375, 0.2, -0.408, 0.204, -0.4, 0.2, -0.367, 0.188, -0.342, 0.221, -0.225, 0.241, -0.183, 0.237, -0.15, 0.266, -0.158, 0.311, -0.2, 0.332, -0.242, 0.311, -0.275, 0.299, -0.258, 0.278, -0.308, 0.278, -0.325, 0.299, -0.292, 0.32, -0.292, 0.324, -0.275, 0.369, -0.283, 0.39, -0.225, 0.41, -0.25, 0.41, -0.2, 0.427, -0.083, 0.443, -0.117, 0.443, -0.167, 0.48, -0.225, 0.505, -0.242, 0.526, -0.15, 0.538, -0.175, 0.542, -0.108, 0.567, -0.15, 0.592, -0.1, 0.608, -0.117, 0.608, -0.175, 0.584, -0.192, 0.596, -0.233, 0.604, -0.192, 0.621, -0.233, 0.654, -0.267, 0.678, -0.342, 0.666, -0.392, 0.678, -0.442, 0.695, -0.4, 0.724, -0.425, 0.711, -0.442, 0.724, -0.475, 0.748, -0.475, 0.773, -0.542, 0.753, -0.617, 0.781, -0.65, 0.847, -0.667, 0.864, -0.692, 0.885, -0.692, 0.864, -0.633, 0.864, -0.55, 0.897, -0.608, 0.901, -0.65, 0.897, -0.683, 0.951, -0.683, 0.984, -0.708, 0.975, -0.733, 0.988, -0.783, 0.897, -0.783, 0.885, -0.783, 0.827, -0.783, 0.794, -0.817, 0.753, -0.792, 0.728, -0.8, 0.707, -0.825, 0.67, -0.8, 0.592, -0.792, 0.633, -0.85, 0.592, -0.85, 0.534, -0.917, 0.509, -0.883, 0.551, -0.867, 0.464, -0.833, 0.439, -0.817, 0.406, -0.8, 0.369, -0.783, 0.398, -0.792, 0.402, -0.75, 0.39, -0.75, 0.332, -0.783, 0.32, -0.8, 0.39, -0.858, 0.315, -0.867, 0.291, -0.808, 0.328, -0.775, 0.266, -0.75, 0.237, -0.733, 0.208, -0.692, 0.188, -0.733, 0.221, -0.733, 0.212, -0.767, 0.192, -0.767, 0.151, -0.808, 0.093, -0.767, 0.068, -0.708, 0.035, -0.708, 0.035, -0.65, 0.06, -0.65, 0.072, -0.633, 0.093, -0.633, 0.105, -0.692, 0.134, -0.725, 0.122, -0.683, 0.159, -0.675, 0.126, -0.65, 0.109, -0.583, 0.064, -0.6, 0.064, -0.642, 0.047, -0.642, 0.052, -0.6, 0.023, -0.567, -0.019, -0.567],
		// japan
		[0.72, -0.383, 0.769, -0.408, 0.777, -0.467, 0.786, -0.517, 0.777, -0.567, 0.798, -0.583, 0.786, -0.542, 0.81, -0.458, 0.786, -0.458, 0.786, -0.408, 0.748, -0.358, 0.736, -0.358, 0.724, -0.325],
		// australia
		[0.781, 0.2, 0.753, 0.183, 0.757, 0.142, 0.736, 0.142, 0.715, 0.183, 0.707, 0.158, 0.687, 0.2, 0.637, 0.25, 0.625, 0.308, 0.641, 0.35, 0.637, 0.4, 0.67, 0.383, 0.687, 0.375, 0.728, 0.342, 0.753, 0.392, 0.765, 0.367, 0.777, 0.417, 0.806, 0.425, 0.827, 0.425, 0.847, 0.317, 0.806, 0.2, 0.802, 0.158, 0.786, 0.133],
		// philippines, papua new guinea and other islands
		[0.555, -0.075, 0.571, -0.05, 0.571, 0, 0.596, 0.025, 0.596, 0.058, 0.645, 0.092, 0.703, 0.092, 0.592, 0.092, 0.555, 0.025, 0.555, -0.008, 0.53, -0.05, 0.559, -0.033],
		[0.649, -0.067, 0.654, -0.033, 0.662, -0.017, 0.645, 0.05, 0.625, 0.033, 0.604, -0.008, 0.645, -0.067],
		[0.67, -0.2, 0.658, -0.175, 0.666, -0.125, 0.649, -0.083, 0.678, -0.117, 0.678, -0.083, 0.695, -0.05, 0.695, -0.117, 0.678, -0.158],
		[0.695, 0.05, 0.724, 0.042, 0.753, 0.05, 0.761, 0.092, 0.781, 0.092, 0.81, 0.092, 0.831, 0.125, 0.814, 0.083, 0.843, 0.025, 0.81, 0.058, 0.773, 0.025, 0.748, 0.042],
		[0.81, 0.467, 0.802, 0.483, 0.814, 0.517, 0.827, 0.475],
		[0.951, 0.4, 0.963, 0.45, 0.922, 0.5, 0.942, 0.533, 0.942, 0.5, 0.959, 0.492, 0.979, 0.433],
		[0.909, 0.242, 0.926, 0.267],
		[0.975, 0.192, 0.992, 0.208],
		[0.06, -0.875, 0.101, -0.842, 0.134, -0.842, 0.155, -0.9],
		// great britain
		[-0.019, -0.65, 0.002, -0.608, -0.014, -0.608, -0.039, -0.633],
		[-0.043, -0.583, -0.043, -0.575, -0.023, -0.567],
		// easter island
		[-0.86, -0.208, -0.847, -0.183]
	];

	let lines: Array<Array<{x: number, y: number, z: number, sx: number, sy: number}>> = [];

	function reparseLines() {
		for (let i = 0; i < linesData.length; ++i) {
			const points = [];
			for (let j = 0; j < linesData[i].length; j += 2) {
				const sinA = Math.sin(linesData[i][j] * Math.PI);
				const cosA = Math.cos(linesData[i][j] * Math.PI);
				const sinB = Math.sin(linesData[i][j + 1] * Math.PI / 2);
				const cosB = Math.cos(linesData[i][j + 1] * Math.PI / 2);
				
				points.push({
					x: opts.globeRadius * cosA * cosB,
					y: opts.globeRadius * sinB,
					z: opts.globeRadius * sinA * cosB,
					sx: 0,
					sy: 0
				});
			}
			
			lines[i] = points;
		}
	}

	reparseLines();
	anim();
</script>