---
import warningHud from '../assets/svg/warning_hud.svg';
---

<div class="warning-hud" id="warning-hud">
	<img src={warningHud.src} alt="Warning HUD" />
</div>

<style>
	.warning-hud {
		position: fixed;
		top: 50%;
		left: 50%;
		transform: translate(-50%, -50%);
		z-index: 1000;
		opacity: 0;
		visibility: hidden;
		transition: all 0.5s ease-out;
		pointer-events: none;
		width: clamp(400px, 60vw, 800px);
		height: auto;
	}

	.warning-hud.show {
		opacity: 1;
		visibility: visible;
		animation: warningPulse 0.5s ease-out, warningShake 0.8s ease-out 0.2s;
	}

	.warning-hud img {
		width: 100%;
		height: auto;
		filter: drop-shadow(0 0 20px rgba(218, 0, 0, 0.8));
	}

	@keyframes warningPulse {
		0% {
			opacity: 0;
			transform: translate(-50%, -50%) scale(0.8);
		}
		50% {
			opacity: 1;
			transform: translate(-50%, -50%) scale(1.05);
		}
		100% {
			opacity: 1;
			transform: translate(-50%, -50%) scale(1);
		}
	}

	@keyframes warningShake {
		0%, 100% {
			transform: translate(-50%, -50%);
		}
		10%, 30%, 50%, 70%, 90% {
			transform: translate(-52%, -50%);
		}
		20%, 40%, 60%, 80% {
			transform: translate(-48%, -50%);
		}
	}

	@media (max-width: 768px) {
		.warning-hud {
			width: clamp(300px, 80vw, 600px);
		}
	}
</style>

<script>
	let scrollTimeout: number;
	let isWarningVisible = false;
	
	function showWarning() {
		if (isWarningVisible) return;
		
		const warningElement = document.getElementById('warning-hud');
		if (warningElement) {
			warningElement.classList.add('show');
			isWarningVisible = true;
			
			// Masquer l'alerte après 3 secondes
			setTimeout(() => {
				warningElement.classList.remove('show');
				isWarningVisible = false;
			}, 3000);
		}
	}
	
	function handleScroll() {
		// Nettoyer le timeout précédent
		clearTimeout(scrollTimeout);
		
		// Vérifier si l'utilisateur a scrollé plus de 100px
		if (window.scrollY > 100 && !isWarningVisible) {
			// Délai de 300ms pour éviter les déclenchements multiples
			scrollTimeout = setTimeout(() => {
				showWarning();
			}, 300);
		}
	}
	
	// Ajouter l'écouteur d'événement scroll
	window.addEventListener('scroll', handleScroll);
	
	// Nettoyer l'écouteur quand on quitte la page
	window.addEventListener('beforeunload', () => {
		window.removeEventListener('scroll', handleScroll);
		clearTimeout(scrollTimeout);
	});
</script>