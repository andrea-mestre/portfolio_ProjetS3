---
interface Props {
	title: string;
	subtitle: string;
	description: string;
	stats: {
		value: string;
		label: string;
	}[];
	id: string;
	date: string;
	imageUrl?: string;
	categories: string[];
}

const { title, subtitle, description, stats, id, date, imageUrl, categories } = Astro.props;
---

<div class="card-container relative w-[350px] h-[505px] m-5 z-10 opacity-0 translate-y-8 animate-[card-reveal_0.8s_ease-out_forwards]" style="perspective: 1000px;">
	<div class="card relative w-full h-full cursor-pointer transition-transform duration-700 ease-out hover:[transform:rotateY(10deg)_rotateX(5deg)]" style="transform-style: preserve-3d;">
		<div class="card-face absolute w-full h-full rounded-[20px] overflow-hidden border border-[var(--color-purple)] shadow-[0_0_30px_rgba(184,187,240,0.5)] bg-gradient-to-br from-[#12121e] to-[#1c1c2d] flex flex-col">
			<div class="absolute inset-5 rounded-xl overflow-hidden bg-gradient-to-br from-[#191927] to-[#13131d] border border-[rgba(184,187,240,0.3)] z-[1]" style="background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZGVmcz48cGF0dGVybiBpZD0iZ3JpZCIgd2lkdGg9IjIwIiBoZWlnaHQ9IjIwIiBwYXR0ZXJuVW5pdHM9InVzZXJTcGFjZU9uVXNlIj48cGF0aCBkPSJNIDIwIDAgTCAwIDAgTCAwIDIwIiBmaWxsPSJub25lIiBzdHJva2U9IiMwMGMzZmYiIHN0cm9rZS13aWR0aD0iMC41IiBvcGFjaXR5PSIwLjIiLz48L3BhdHRlcm4+PC9kZWZzPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9InVybCgjZ3JpZCkiLz48L3N2Zz4='); background-blend-mode: overlay; background-opacity: 0.3;">
				
			
				<div class="study-year absolute top-5 left-4 z-[2] font-[family-name:var(--font-title2)] text-xs font-bold uppercase text-[var(--color-purple)] tracking-wider inline-block px-2 py-1 bg-gradient-to-br from-[rgba(184,187,240,0.15)] to-[rgba(150,46,185,0.15)] border border-[rgba(184,187,240,0.3)] rounded-md backdrop-blur-sm" style="text-shadow: 0 0 10px rgba(184, 187, 240, 0.7);">{subtitle}</div>
				
				<div class="card-header relative z-[2] pb-3 pt-16">
					{imageUrl && (
						<div class="w-60 h-40 rounded-lg overflow-hidden mx-auto mb-4 border border-[rgba(184,187,240,0.4)] p-2 bg-gradient-to-br from-[rgba(184,187,240,0.1)] to-[rgba(150,46,185,0.1)] shadow-[0_0_15px_rgba(184,187,240,0.3)] transition-all duration-300 hover:shadow-[0_0_20px_rgba(184,187,240,0.5)] hover:scale-105">
							<img src={imageUrl} alt={title} class="w-full h-full object-contain opacity-80 hover:opacity-100 transition-opacity duration-300 brightness-90 contrast-110" />
						</div>
					)}
					
					<h3 class="font-[family-name:var(--font-title2)] text-xl font-bold uppercase text-[var(--color-purple)] mb-2 tracking-wide text-center" style="text-shadow: 0 0 10px rgba(184, 187, 240, 0.7);">{title}</h3>
					<div class="font-[family-name:var(--font-text)] text-xs text-[var(--color-pink)] mb-1 uppercase tracking-wider text-center">{categories && categories.length > 0 ? categories[0] : subtitle}</div>
					<div class="font-[family-name:var(--font-smalltext)] text-xs text-[rgba(184,187,240,0.6)] uppercase tracking-wide absolute top-6 right-6">{date}</div>
				</div>

				<div class="card-content relative z-[2] px-6 flex-1">
					<p class="font-[family-name:var(--font-text)] text-sm text-[#b3b3cc] leading-relaxed tracking-wide mb-6 text-center">{description}</p>

					<div class="card-stats flex justify-between mb-5">
						{stats.map((stat) => (
							<div class="stat text-center">
								<div class="font-[family-name:var(--font-smalltext)] text-xl text-[var(--color-purple)] font-bold" style="text-shadow: 0 0 10px rgba(184, 187, 240, 0.7);">{stat.value}</div>
								<div class="font-[family-name:var(--font-text)] text-xs text-[#b3b3cc] uppercase tracking-wide mt-1">{stat.label}</div>
							</div>
						))}
					</div>
				</div>

				<div class="card-footer relative z-[2] p-6 flex justify-center items-center">
					<div class="font-[family-name:var(--font-smalltext)] text-xs text-[var(--color-purple)]" style="text-shadow: 0 0 10px rgba(184, 187, 240, 0.7);">{id}</div>
				</div>
			</div>

			<div class="glow-effect absolute inset-0 rounded-[20px] shadow-[inset_0_0_20px_rgba(184,187,240,0.3)] pointer-events-none z-[3]"></div>
			<div class="absolute inset-0 rounded-[20px] shadow-[inset_0_0_2px_rgba(255,255,255,0.3)] pointer-events-none z-[4]"></div>
			<div class="absolute inset-0 overflow-hidden opacity-15 z-[5] pointer-events-none rounded-[20px] after:content-[''] after:absolute after:w-full after:h-0.5 after:bg-[rgba(184,187,240,0.5)] after:animate-[scanline_6s_linear_infinite] after:top-0"></div>
			<div class="absolute inset-0 opacity-0 pointer-events-none z-[6] rounded-[20px] animate-[glitch-effect_12s_infinite]"></div>
			<div class="absolute inset-0 bg-gradient-to-br from-[rgba(184,187,240,0.1)] to-[rgba(184,187,240,0.1)] rounded-[20px] opacity-50 z-[7] pointer-events-none"></div>
		</div>
	</div>
</div>

<style>
	@keyframes card-reveal {
		0% { opacity: 0; transform: translateY(30px); }
		100% { opacity: 1; transform: translateY(0); }
	}
	
	@keyframes scanline {
		0% { top: 0%; }
		100% { top: 100%; }
	}
	
	@keyframes glitch-effect {
		0%, 1.5%, 15%, 16%, 100% { opacity: 0; }
		1% { 
			opacity: 0.3; 
			transform: translate3d(3px, 0, 0);
			background: linear-gradient(90deg, rgba(184, 187, 240, 0.2) 0%, rgba(184, 187, 240, 0.2) 100%);
		}
		15.5% { 
			opacity: 0.3; 
			transform: translate3d(-3px, 0, 0);
			background: linear-gradient(90deg, rgba(184, 187, 240, 0.2) 0%, rgba(184, 187, 240, 0.2) 100%);
		}
	}
	.card-container:nth-child(1) { animation-delay: 0.2s; }
	.card-container:nth-child(2) { animation-delay: 0.4s; }
	.card-container:nth-child(3) { animation-delay: 0.6s; }
</style>

<script>
<script>
	document.addEventListener('DOMContentLoaded', () => {
		const cardContainers = document.querySelectorAll<HTMLElement>('.card-container');
		
		cardContainers.forEach((cardContainer) => {
			const card = cardContainer.querySelector<HTMLElement>('.card');
			const glowEffect = cardContainer.querySelector<HTMLElement>('.glow-effect');
			
			if (!card || !glowEffect) return;
			
			cardContainer.addEventListener('mousemove', function (e) {
				const mouseEvent = e as MouseEvent;
				const rect = cardContainer.getBoundingClientRect();
				const x = mouseEvent.clientX - rect.left;
				const y = mouseEvent.clientY - rect.top;

				const centerX = rect.width / 2;
				const centerY = rect.height / 2;

				const deltaX = (x - centerX) / centerX;
				const deltaY = (y - centerY) / centerY;

				card.style.transform = `rotateY(${deltaX * 15}deg) rotateX(${-deltaY * 15}deg)`;
				glowEffect.style.boxShadow = `inset ${-deltaX * 10}px ${-deltaY * 10}px 20px rgba(184, 187, 240, 0.3)`;
			});

			cardContainer.addEventListener('mouseleave', function () {
				card.style.transform = 'rotateY(0) rotateX(0)';
				glowEffect.style.boxShadow = 'inset 0 0 20px rgba(184, 187, 240, 0.3)';
			});
		});
	});
</script>